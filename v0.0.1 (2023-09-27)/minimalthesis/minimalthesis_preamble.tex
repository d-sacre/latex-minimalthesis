\documentclass[
				a4paper,
				bibliography=totoc,
				listof=totoc,
				noindent,
				parskip=full,
				twoside,
				open=any,
				BCOR=1cm,
				headsepline,
			  ]{scrreprt}
			  
	\usepackage[english]{babel}

% usepackages related to font/encoding
	\usepackage[utf8]{inputenc}
	\usepackage{fontenc}
	
	
	\usepackage{csquotes}
	\usepackage{enumitem}
	% \usepackage{tocloft}
	
	% to get komavar functionality within scrreprt
	\usepackage{scrletter}
	
	\newkomavar{mt::style}
	\setkomavar{mt::style}{plain}
	
	\newkomavar{mt::font}
	\setkomavar{mt::font}{serif}
	
	

% page layout, headers
	\usepackage[top=1.5cm, bottom=1.5cm, includeheadfoot,showframe=false,asymmetric]{geometry}%left=2.5cm, right=3.5cm,
	

 % does not work with scrlttr2
%	\usepackage[automark,
%	headsepline=0.5pt]{scrlayer-scrpage}
%	\pagestyle{scrheadings}
%	\addtokomafont{headsepline}{\color{black}}

	\usepackage{scrlayer-scrpage}
	\pagestyle{scrheadings}
	

	\clearpairofpagestyles

	\automark[section]{chapter}


	\clearmainofpairofpagestyles
	\chead{\small\rightorleftmark}
	\cfoot[\pagemark]{\pagemark} %Seitenzahl zentriert im Fuß
	

	\makeatletter
	\newcommand{\rightorleftmark}{%
			\begingroup\protected@edef\x{\rightmark}%
			\ifx\x\@empty
				\endgroup
				\leftmark
			\else
				\endgroup
				\rightmark
			\fi
		}
	\makeatother
	%%%%%https://tex.stackexchange.com/questions/101915/latex-fancyhdr-is-possible-to-use-leftmark-and-rightmark-alternatively

	\renewcommand*{\chapterheadstartvskip}{\vspace*{0cm}}
	\renewcommand*{\chapterheadendvskip}{\vspace{0.5cm}}

	\makeatletter
	 %% check if this are the original definitions
	\CheckCommand\section{%
	  \scr@startsection{section}{\sectionnumdepth}{\z@}%
	  {-3.5ex \@plus -1ex \@minus -.2ex}%
	  {2.3ex \@plus.2ex}%
	  {\ifnum \scr@compatibility>\@nameuse{scr@v@2.96}\relax
	    \setlength{\parfillskip}{\z@ plus 1fil}\fi
	    \raggedsection\normalfont\sectfont\nobreak\size@section}%
	}

	\renewcommand\section{%
	  \scr@startsection{section}{\sectionnumdepth}{\z@}%
	  {-.5\baselineskip}%
	  {.0625\baselineskip}%
	  {\ifnum \scr@compatibility>\@nameuse{scr@v@2.96}\relax
	    \setlength{\parfillskip}{\z@ plus 1fil}\fi
	    \raggedsection\normalfont\sectfont\nobreak\size@section}%
	}
	\makeatother


%usepackages related to graphics
\usepackage[dvipsnames]{xcolor}
\usepackage{graphicx}
\usepackage{tikz}
\usepackage{wrapfig}

\usetikzlibrary{calc,arrows, intersections,arrows.meta}
\usetikzlibrary{shapes.arrows,shapes.geometric,decorations.markings,positioning}
\usetikzlibrary{spy}
\usetikzlibrary{fadings}
\usetikzlibrary{mindmap,trees}

%usepackages related to science
\usepackage{siunitx}
\usepackage{mhchem}
\usepackage{amsmath,bm,amssymb}
\usepackage{physics} % derivative, differentials
\usepackage{derivative}
\usepackage{harpoon} %provides \overrightharp
\usepackage{tikz-3dplot}


\usepackage{pgfplots}
\pgfplotsset{compat=1.18}
\usepackage{pgfplotstable}
\usepgfplotslibrary{fillbetween,groupplots}


\usepgfplotslibrary{external}
\tikzexternalize[prefix=tikzexternalize/]

%\pgfplotsset{
%    legend image with text/.style={
%        legend image code/.code={%
%            \node[anchor=center] at (0.3cm,0cm) {#1};
%        }
%    },
%}

\usepackage{blindtext}
\usepackage{listings}

\usepackage[labelfont={bf}]{caption}
\captionsetup{format=plain,labelformat=simple,font=small,labelsep = colon}

\usepackage{tabulary}
\usepackage{multirow,makecell,cellspace}
\usepackage{multicol}
\usepackage{booktabs,colortbl,array}



% Bibliography
\usepackage[
    backend=biber,
    style=chem-angew,
	articletitle,
    % sortlocale=de_DE,
		% style=apsrev4-1,
	sorting=none,
    natbib=true,
    url=false,
    doi=true,
    eprint=true,
	maxbibnames=99,
]{biblatex}

\input{./minimalthesis/minimal-thesis_formatting-bib-entries.tex}
\ExecuteBibliographyOptions{thesistitle}



% Hyperref setup
\usepackage[hidelinks]{hyperref}

\definecolor{mtColorAccent}{HTML}{a2376f}
\newkomavar{mt::scshape-override}
\setkomavar{mt::scshape-override}{\bfseries}
\def\scshapeOverride{\scshape}

% to insert hyperref setup before \begin{document}
% adapted from: https://comp.text.tex.narkive.com/Ifp6XTl9/redefining-document-enddocument 
\let\olddocument\document
\let\oldenddocument\enddocument

\renewcommand{\document}{%
	% changing default font
	\usekomavar[\ifstr]{mt::font}{serif}{%
		\usepackage{lmodern}
		\usepackage{microtype}
	}{}
	
	\usekomavar[\ifstr]{mt::font}{sans-serif}{%
		\usepackage{tgtermes}
		\renewcommand*\familydefault{\sfdefault}
		\def\scshapeOverride{\normalfont\usekomavar{mt::scshape-override}}
	}{}
	%	
	
	% changing the style of document
	\colorlet{mtColorHeadline}{gray}
	\usekomavar[\ifstr]{mt::style}{plain}%
	{%
		\addtokomafont{headsepline}{\color{black}}%
		\setkomafont{pageheadfoot}{\scshapeOverride}%
	}% true part
	{ %
		\usekomavar[\ifstr]{mt::style}{fancy-grayscale}%
		{
			\colorlet{mtColorHeadline}{gray}
			\colorlet{mtColorAccent}{gray}
		}% true
		{}% false
		
		\usekomavar[\ifstr]{mt::style}{fancy-colorful}%
		{
			\colorlet{mtColorHeadline}{mtColorAccent}
		}%true
		{}%false
		
		\addtokomafont{headsepline}{\color{mtColorAccent}}%
		\setkomafont{pageheadfoot}{\scshapeOverride\color{mtColorAccent}}%
		
		\addtokomafont{chapter}{\color{mtColorHeadline}}
		\addtokomafont{section}{\color{mtColorHeadline}}
		\addtokomafont{subsection}{\color{mtColorHeadline}}
		\addtokomafont{subsubsection}{\color{mtColorHeadline}}
	}% false part
	
	% source: https://komascript.de/node/1918
	\begingroup
	\usekomavar[\def\author]{mt::author::name}
	\usekomavar[\def\mtpdfmaintitle]{mt::thesis::title}
	\usekomavar[\def\mtpdfsubtitle]{mt::thesis::subtitle}
	
	\Ifkomavarempty{mt::thesis::subtitle}{
		\def\mtpdftitle{\mtpdfmaintitle}
	}{
		\def\mtpdftitle{\mtpdfmaintitle~– \mtpdfsubtitle}
	}
	
	\hypersetup{
		pdftitle={\mtpdftitle},
		pdfsubject={Academic Thesis},
		pdfauthor={\author},
		pdfkeywords={Academic Thesis}
	}
	\endgroup
	
	\olddocument%
	\begingroup%
	\renewcommand{\document}{\begingroup}%
	\renewcommand{\enddocument}{\endgroup\oldenddocument}%
	\let\oldenddocument\relax%
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%% Additional command definition %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% defining all the mt specific komavars
\newkomavar[\Large\scshape]{mt::author::name}
\newkomavar[from ]{mt::author::place-of-birth}
\newkomavar{mt::author::number-of-affiliations}
\newkomavar[\Huge\bfseries]{mt::thesis::title}
\newkomavar[\huge\bfseries]{mt::thesis::subtitle}
\newkomavar{mt::thesis::titlepage::logo}
\newkomavar[\Large]{mt::thesis::type}
\newkomavar[To obtain the Academic Degree]{mt::thesis:legal-type-identifier}
\newkomavar[\large]{mt::handed-in-by}

\newkomavar[\large]{mt::institute}
\newkomavar[\large]{mt::faculty}
\newkomavar[\large]{mt::group}
\newkomavar{mt::date}
\newkomavar[\textbf{Examination Committee:}]{mt::examination-committee}

% setting some default values for certain specific mt komavars
\setkomavar{mt::handed-in-by}{handed in by}
\setkomavar{mt::author::number-of-affiliations}{1}
\setkomavar{mt::date}{\today}

% defining helper macros
\newcommand{\mtIfKomavarNotEmptyWithoutOption}[1]{
	\Ifkomavarempty{#1}{}{%
		{\usekomavar{#1}\\}%
	}
}

\newcommand{\mtIfKomavarNotEmptyWithOption}[1]{
	\Ifkomavarempty{#1}{}{%
		{\usekomavar*{#1}\usekomavar{#1}\\}%
	}
}

\newcommand{\mtIfKomavarNotEmptyWithOptionTABLE}[1]{
	\Ifkomavarempty{#1}{}{%
		\usekomavar*{#1}\usekomavar{#1}\\%
	}
}


\newcommand{\mtTitlepage}{%
	\newgeometry{twoside,outer=2.5cm,inner=3.5cm,top=2cm,bottom=2cm,includeheadfoot}
	\begin{titlepage}
		\centering
		\vfil
		{\usekomavar*{mt::thesis::title}\usekomavar{mt::thesis::title}\\}
		\Ifkomavarempty{mt::thesis::subtitle}{}{%
			{\usekomavar*{mt::thesis::subtitle}\usekomavar{mt::thesis::subtitle}\\}%
		}
		\vfill
		\Ifkomavarempty{mt::thesis::titlepage::logo}{}{%
			\usekomavar{mt::thesis::titlepage::logo}\\
			\vfill
		}
		{\usekomavar*{mt::thesis::type}\usekomavar{mt::thesis::type}\\}
		{\large \usekomavar*{mt::thesis:legal-type-identifier}\\}
		{\enquote{\usekomavar{mt::thesis:legal-type-identifier}}\vfil}
		{\usekomavar*{mt::handed-in-by} \usekomavar{mt::handed-in-by}\\}
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		% if sans-serif font selected
		\usekomavar[\ifstr]{mt::font}{sans-serif}{%
			% if default author format string is \Large\scshape:
			\usekomavar*[\ifstr]{mt::author::name}{\Large\scshape}{%
				{\Large\bfseries\usekomavar{mt::author::name}\\[0.125cm]}%
			}{%
				{\usekomavar*{mt::author::name}\usekomavar{mt::author::name}\\[0.125cm]}%
			}%
		}{%
			{\usekomavar*{mt::author::name}\usekomavar{mt::author::name}\\[0.125cm]}%
		}
		%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
		{\large\usekomavar*{mt::author::place-of-birth}\usekomavar{mt::author::place-of-birth}}
		\vfil
		\usekomavar[\ifstr]{mt::author::number-of-affiliations}{1}{
			\mtIfKomavarNotEmptyWithOption{mt::institute}
			\mtIfKomavarNotEmptyWithOption{mt::faculty}
			\mtIfKomavarNotEmptyWithOption{mt::group}
		}{}
		
		\usekomavar[\ifstr]{mt::author::number-of-affiliations}{2}{
			\begin{tabular}{m{0.45\linewidth}<{\centering}m{0.45\linewidth}<{\centering}}
				\mtIfKomavarNotEmptyWithOptionTABLE{mt::institute}
				\mtIfKomavarNotEmptyWithOptionTABLE{mt::faculty}
				\mtIfKomavarNotEmptyWithOptionTABLE{mt::group}
			\end{tabular}
		}{}
		
		\vfill
		{\usekomavar{mt::date}\\}
		\vfill
		\mtIfKomavarNotEmptyWithoutOption{mt::examination-committee}
		\normalsize
	
	\end{titlepage}
	
	\newpage\null\thispagestyle{empty}
} 

\newcommand{\mtLogoTitlepage}{
	\vspace{0.5cm}
	\includegraphics{./minimalthesis/img/minimalthesis_logo.pdf}
	\vspace{0.5cm}
}

\newcommand{\mtTOC}{
	\newgeometry{left=3cm,right=2.5cm,top=2.75cm,bottom=2.75cm}
	{
		\renewcommand{\rightorleftmark}{appendix}
		\tableofcontents
	}
	
	\newgeometry{twoside,outer=2.5cm,inner=3.5cm,top=2cm,bottom=2cm,includeheadfoot}
	\newpage\null\thispagestyle{empty}
}

